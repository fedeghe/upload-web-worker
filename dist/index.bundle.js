(()=>{"use strict";function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}var r={d:(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},e={},u=(r.r(e),r.d(e,{default:()=>h}),new function(){var e=0,t=this;this.prefix="UWW_",this.toString=function(){return e+=1,t.prefix+e}}),t=(self.FormData=n,XMLHttpRequest.prototype.send);function n(){if(!(this instanceof n))return new n;this.boundary="------RWWorkerFormDataBoundary"+Math.random().toString(36);var r=this.data=[];this.__append=function(e){var t,n=0;if("string"==typeof e)for(t=e.length;n<t;n++)r.push(255&e.charCodeAt(n));else if(e&&e.byteLength)for((t=(e="byteOffset"in e?e:new Uint8Array(e)).byteLength);n<t;n++)r.push(255&e[n])}}XMLHttpRequest.prototype.send=function(e){return e instanceof n&&(e.__endedMultipart||e.__append("--"+e.boundary+"--\r\n"),e.__endedMultipart=!0,this.setRequestHeader("Content-Type","multipart/form-data; boundary="+e.boundary),e=new Uint8Array(e.data).buffer),t.call(this,e)},n.prototype.append=function(e,t,n){this.__endedMultipart&&(this.data.length-=this.boundary.length+6,this.__endedMultipart=!1);var r=Object.prototype.toString.call(t),o="--"+this.boundary+'\r\nContent-Disposition: form-data; name="'+e+'"';if(/^\[object (?:Blob|File)(?:Constructor)?\]$/.test(r))return this.append(e,new Uint8Array((new FileReaderSync).readAsArrayBuffer(t)),n||t.name);/^\[object (?:Uint8Array|ArrayBuffer)(?:Constructor)?\]$/.test(r)?(o+='; filename="'+(n||"blob").replace(/"/g,"%22")+'"\r\n',this.__append(o+="Content-Type: application/octet-stream\r\n\r\n"),this.__append(t),o="\r\n"):o+="\r\n\r\n"+t+"\r\n",this.__append(o)};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d=["file","url","headers","method"];function i(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function l(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?i(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=function(e){e=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===a(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function p(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),a=0;a<o.length;a++)n=o[a],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}var o="self.requests = {};\nself.onmessage = event => {\n    const {\n        data: {\n            id, url, file, method, headers,\n            action = false\n        }\n    } = event;\n    const { requests } = self;\n    if (!action) return;\n    switch (action) {\n        case 'start-upload': \n            post = true;\n            requests[id] = upload({\n                id,\n                url,\n                file,\n                headers,\n                method, \n                worker: self,\n            });\n            break;\n        case 'abort-upload':\n            post = true;\n            if (id in requests) {\n                requests[id].xhr.abort();\n                requests[id].xhr = null;\n                delete requests[id];\n            }\n            break;\n        default:\n            break;\n    }\n};\nconst upload = ({ id, url, file, worker, method, headers = {} }) => {\n    const xhr = new XMLHttpRequest(),\n        total = file.size,\n        progress = e => {\n            worker.postMessage({\n                action: 'progress',\n                id,\n                fileName: file.name,\n                progress: {\n                    percent: ((100 * e.loaded) / total).toFixed(2),\n                    loaded: e.loaded,\n                    total,\n                }\n            });\n        };\n    if (xhr.upload) {\n        xhr.upload.addEventListener('progress', progress);\n    } else {\n        xhr.addEventListener('progress', progress);\n    }\n    xhr.addEventListener('loadend', () => {\n        if ( xhr.status === 200 && xhr.readyState === 4) {\n            worker.postMessage({\n                action: 'end',\n                fileName: file.name,\n                id,\n            });\n        }\n    });\n\n    xhr.addEventListener('error', () => {\n        worker.postMessage({\n            action: 'error',\n            id,\n            fileName: file.name,\n            data: {\n                status: xhr.status,\n            }\n        });\n    });\n    xhr.addEventListener('abort', () => {\n        worker.postMessage({\n            action: 'abort',\n            id\n        });\n    });\n    \n    xhr.open(method, url, true);\n    Object.keys(headers).forEach(h => xhr.setRequestHeader(h, headers[h]));\n    xhr.send(file);    \n    \n    worker.postMessage({\n        action: 'start',\n        id,\n        fileName: file.name,\n    });\n    \n    return { xhr };\n}".replace(/\n|\s{2,}/gm," "),o=new Blob([o],{type:"text/javascript"}),c=window.webkitURL||window.URL,f=new Worker(c.createObjectURL(o)),b=["start","progress","end","error","abort"],y={worker:f,queue:{},start:function(e){var t=e.file,n=e.url,r=e.headers,o=e.method,a=p(e,d),e="".concat(u),i=l({id:e,url:n,file:{name:t.name,type:t.type,size:t.size,loaded:0,percent:0}},b.reduce(function(e,t){t="on".concat(s(t));return e[t]=a[t]||null,e},{}));return y.queue[e]=i,f.postMessage({action:"start-upload",id:e,url:n,file:t,method:o,headers:r}),e},abort:function(e){f.postMessage({action:"abort-upload",id:e})}};y.worker.onmessage=function(e){var t=e.data,e=e.data,n=e.id,e=e.action,r="on".concat(s(e)),o=y.queue[n];o&&b.includes(e)&&o[r]&&o[r](t),"onAbort"===r&&n in y.queue&&setTimeout(function(){delete y.queue[n]},500)};const h=y;module.exports=e})();